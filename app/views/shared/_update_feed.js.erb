<% if session[:feed_status] == "public" %>
	  $('#public-button').addClass('selected');
  	$('#private-button').removeClass('selected');
  	$('#favorites-button').removeClass('selected');
<% elsif session[:feed_status] == "favorites" %>
  	$('#public-button').removeClass('selected');
    $('#user-posts-button').removeClass('selected');
    $('#tagged-button').removeClass('selected');
  	$('#private-button').removeClass('selected');
  	$('#favorites-button').addClass('selected');
<% elsif session[:feed_status] == "private" %>
  	$('#public-button').removeClass('selected');
  	$('#private-button').addClass('selected');
  	$('#favorites-button').removeClass('selected');
<% elsif session[:feed_status] == "tagged" %>
    $('#user-posts-button').removeClass('selected');
    $('#favorites-button').removeClass('selected');
  	$('#tagged-button').addClass('selected');
<% elsif session[:feed_status] == "user" %>
    $('#user-posts-button').addClass('selected');
    $('#favorites-button').removeClass('selected');
  	$('#tagged-button').removeClass('selected');
<% end %>

<% if session[:sort_order] == "recent" %>
  	$('#recent-button').addClass('selected');
  	$('#popular-button').removeClass('selected');
<% else %>
  	$('#recent-button').removeClass('selected');
  	$('#popular-button').addClass('selected');
<% end %>
  
$('#filter-title').html('<%= escape_javascript(filter_title(session[:filter_title])) %>');
$('#feed-items').html('<%= escape_javascript(render(:partial => "shared/feed")) %>');

<% unless session[:category_filter] == "all" %>
	<% cat = Category.find(session[:selected_category]) %>
	<% unless cat.ancestry.nil? %>
    	$('#<%= cat.id %>-unread').html('<em><%= Post.unread_count(current_user, cat) %></em>');	
    	$('#<%= cat.root.id %>-unread').html('<em><%= Post.unread_count(current_user, cat.root) %></em>');
  	<% end %>
<% end %>

$('#friend-block').html('<%= escape_javascript(render(:partial => "shared/friend_block")) %>').hide().show();

//TODO: THIS IS REPEATED - DRY UP WITH METHOD CALL TO ONE PLACE?
$('.content a').attr('target', '_blank');
$('.content a').addClass('original-link');
//Translate links in post text to embedded content
$('.content').embedly({
	//Place embedded content after post
	method: "after",
	maxWidth: 500,
	chars: 150,
	key: '6c398a44d6034de4b75ea047c32e83fe', //TODO: CHANGE THIS TO CLIENT'S API KEY
		
	//Override default success callback to insert target into anchors
	success: function(oembed, dict){
		var _a, elem = $(dict.node);
		if (! (oembed) ) { return null; }
		oembed.code = oembed.code.replace('<a href', '<a target="_blank" href');
		return elem.after(oembed.code);
	}
});
		
$('.pagination a').attr('data-remote', 'true');